# SAP Cloud Platform - Cloud Foundry - Python - Docker - Sample Application
[![CircleCI](https://dl.circleci.com/status-badge/img/gh/kcirtapfromspace/cloudfoundry_circleci/tree/main.svg?style=svg)](https://dl.circleci.com/status-badge/redirect/gh/kcirtapfromspace/cloudfoundry_circleci/tree/main)

## Prerequisites
### Cloud Foundry CLI
Get a free trial account on SAP Cloud Platform
https://developers.sap.com/tutorials/hcp-create-trial-account.html

Grab Cloud Foundry Envionment details
API Endpoint: [https://api.cf.us10-001.hana.ondemand.com](https://api.cf.us10-001.hana.ondemand.com)
Org Name: `c44fa123trial`
Org ID: `220fb074-bdf1-489f-b6ba-0f32e7e9054a`

### CircleCI
Get a free account on CircleCI
[circle ci][circle ci]
bootstrap your project with CircleCI

#### View the CircleCI pipeline
[https://app.circleci.com/pipelines/github/kcirtapfromspace/cloudfoundry_circleci](https://app.circleci.com/pipelines/github/kcirtapfromspace/cloudfoundry_circleci)

### Github
Create a new repository on Github

#### Bot Account
Create a bot account on Github
this can be as easy as adding `+bot_account` to your email address to create a new account
`<email>+bot_account@gmail.com`

Once that account is created you can add it as a collaborator to your repository.
Sign in to your bot account and accept the invitation to collaborate.


Follow steps in [Personal Access Token(classic)](#personal-access-tokenclassic) to create a PAT for your bot account.


#### Deploy Key
Authenticating CircleCI server to commit the artifact (e.g., report, plot, documentation) generated by CircleCI job on your behalf to GitHub.

When we authenticate CircleCI to build a GitHub repository for the first time, it adds a Read-Only deploy key to our GitHub repo. This can be found in GitHub Repo → Settings → Deploy Keys

#### Personal Access Token(classic)
Create a new Personal Access Token(classic) with `repo` and `write:packages` permissions

Generate a GitHub PAT, either for your own account or a bot account, with the required scope to write to your repository (public_repo for a public repository, repo for a private repository) and write:packages for GitHub Packages. This token will be used to authenticate the CircleCI server to push the Docker image to GitHub Packages.

[refer GitHub PAT generation](https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token)
You would then define this as an environment variable in your CircleCI build (e.g., GITHUB_PAT) in the Project Settings → Environment Variables → Add Environment Variable.

This would authenticate you to push to your repository using the following URL pattern: https://workflowr:$GITHUB_PAT@github.com/<account>/<repo>.git.

It is not possible to limit the scope of a PAT to a single repository. In other words, if a PAT with write permissions is exposed, it gives write access to every repository owned by that account. Therefore, it is recommended to create a separate GitHub account for CircleCI to use, and give it access to only the repositories that it needs to push to.


### Docker
Create circleci to build docker images and publish to github packages

```
$ export GH_BOT_PAT=YOUR_TOKEN
$ echo $GH_BOT_PAT | docker login ghcr.io -u USERNAME --password-stdin

Login Succeeded
```

[github circleci auth]: https://medium.com/@praveena.vennakula/github-circleci-authentication-ef1e85d24b0
[cloud foundry trial account]: https://developers.sap.com/tutorials/hcp-create-trial-account.html
[circle ci]: https://circleci.com/signup/